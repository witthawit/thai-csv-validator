<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV First Column Extractor</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 900px;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="container bg-white p-8 rounded-lg shadow-xl w-full">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">CSV First Column Extractor</h1>
        <p class="text-center text-gray-600 mb-8">Upload a CSV file to extract and display only the first column of each row.</p>

        <div class="flex flex-col md:flex-row items-center justify-center gap-4 mb-8">
            <input 
                type="file" 
                id="file-input" 
                accept=".csv" 
                class="block w-full text-sm text-gray-500
                       file:mr-4 file:py-2 file:px-4
                       file:rounded-full file:border-0
                       file:text-sm file:font-semibold
                       file:bg-violet-50 file:text-violet-700
                       hover:file:bg-violet-100"
            />
            <button 
                id="process-button" 
                class="w-full md:w-auto px-6 py-2 bg-indigo-600 text-white font-semibold rounded-full shadow-lg
                       hover:bg-indigo-700 transition duration-300 ease-in-out"
            >
                Process File
            </button>
        </div>

        <div id="loading-indicator" class="hidden text-center text-indigo-600 mb-4">
            <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-8 w-8 mx-auto mb-2"></div>
            Processing data...
        </div>

        <div id="results-container" class="mt-8 overflow-x-auto">
            <!-- Results table will be rendered here -->
        </div>

        <div id="save-button-container" class="mt-4 hidden text-center">
            <button 
                id="save-button" 
                class="w-full md:w-auto px-6 py-2 bg-green-600 text-white font-semibold rounded-full shadow-lg
                       hover:bg-green-700 transition duration-300 ease-in-out"
            >
                Save to File
            </button>
        </div>

        <!-- Custom Modal for Errors -->
        <div id="error-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
            <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                <div class="mt-3 text-center">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">Error</h3>
                    <div class="mt-2 px-7 py-3">
                        <p id="error-message" class="text-sm text-gray-500"></p>
                    </div>
                    <div class="items-center px-4 py-3">
                        <button id="close-modal-btn" class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fileInput = document.getElementById('file-input');
            const processButton = document.getElementById('process-button');
            const saveButton = document.getElementById('save-button');
            const saveButtonContainer = document.getElementById('save-button-container');
            const resultsContainer = document.getElementById('results-container');
            const loadingIndicator = document.getElementById('loading-indicator');
            const errorModal = document.getElementById('error-modal');
            const errorMessage = document.getElementById('error-message');
            const closeModalBtn = document.getElementById('close-modal-btn');

            let extractedData = []; // Variable to hold the extracted data

            /**
             * Displays an error message in a modal.
             * @param {string} message - The error message to display.
             */
            function showError(message) {
                errorMessage.textContent = message;
                errorModal.classList.remove('hidden');
            }

            // Close the error modal
            closeModalBtn.addEventListener('click', () => {
                errorModal.classList.add('hidden');
            });

            /**
             * Hides the loading indicator and enables the process button.
             */
            function toggleLoading(isLoading) {
                if (isLoading) {
                    loadingIndicator.classList.remove('hidden');
                    processButton.disabled = true;
                    processButton.classList.add('opacity-50', 'cursor-not-allowed');
                    saveButtonContainer.classList.add('hidden');
                } else {
                    loadingIndicator.classList.add('hidden');
                    processButton.disabled = false;
                    processButton.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }

            processButton.addEventListener('click', () => {
                const file = fileInput.files[0];
                if (!file) {
                    showError("Please select a CSV file first.");
                    return;
                }

                toggleLoading(true);

                const reader = new FileReader();
                reader.onload = function(e) {
                    const text = e.target.result;
                    processCSV(text);
                };
                reader.onerror = function() {
                    showError("Failed to read the file.");
                    toggleLoading(false);
                };
                
                // Read the file as text with UTF-8 encoding
                reader.readAsText(file, 'UTF-8');
            });

            saveButton.addEventListener('click', () => {
                if (extractedData.length > 0) {
                    saveToFile(extractedData.join('\n'));
                } else {
                    showError("No data to save. Please process a CSV file first.");
                }
            });

            /**
             * Processes the CSV text to extract the first column.
             * @param {string} csvText - The raw CSV content as a string.
             */
            function processCSV(csvText) {
                try {
                    const lines = csvText.split(/\r?\n/).filter(line => line.trim() !== '');
                    if (lines.length === 0) {
                        showError("CSV file is empty.");
                        toggleLoading(false);
                        return;
                    }
                    
                    extractedData = lines.map(line => {
                        const values = line.split(',');
                        return values[0] ? values[0].trim() : ''; // Get the first column and trim whitespace
                    });
                    
                    renderResults(extractedData);
                    saveButtonContainer.classList.remove('hidden'); // Show save button after successful processing
                } catch (error) {
                    console.error("Error processing CSV:", error);
                    showError("An error occurred while processing the CSV file.");
                } finally {
                    toggleLoading(false);
                }
            }

            /**
             * Renders the extracted data in a table.
             * @param {Array<string>} data - The array of strings from the first column.
             */
            function renderResults(data) {
                if (data.length === 0) {
                    resultsContainer.innerHTML = `<p class="text-center text-gray-500">No data found in the first column.</p>`;
                    return;
                }

                let tableHtml = `
                    <table class="min-w-full divide-y divide-gray-200 rounded-lg shadow-md">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Extracted Data</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                `;

                data.forEach(item => {
                    tableHtml += `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item}</td>
                        </tr>
                    `;
                });
                
                tableHtml += `</tbody></table>`;
                resultsContainer.innerHTML = tableHtml;
            }

            /**
             * Creates and downloads a text file with the given content.
             * @param {string} content - The text content to save.
             */
            function saveToFile(content) {
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'first_column_data.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        });
    </script>
</body>
</html>
